# DNS 주요 레코드 상세 가이드

## 개요

DNS의 가장 핵심적인 4가지 레코드 타입(A, CNAME, MX, NS)에 대한 상세 설명

## 레코드 타입 비교표

| 레코드 타입 | 주요 목적 | 값의 형식 | 사용 위치 | 다른 레코드와 공존 |
|------------|----------|-----------|----------|------------------|
| **A** | 도메인을 IPv4 주소로 매핑 | IPv4 주소 (예: 192.0.2.1) | 루트 도메인, 서브도메인 | 가능 (MX, TXT 등과 함께) |
| **CNAME** | 도메인 별칭 생성 | 다른 도메인 이름 | 서브도메인만 | 불가능 (단독 사용) |
| **MX** | 메일 서버 지정 | 메일 서버 도메인 + 우선순위 | 루트 도메인, 서브도메인 | 가능 |
| **NS** | 네임서버 지정 | 네임서버 도메인 | 루트 도메인, 위임된 서브도메인 | 가능 |

## A 레코드 (Address Record)

### 설명
- 도메인 이름을 IPv4 주소로 변환하는 가장 기본적인 DNS 레코드
- 웹사이트 방문 시 실제 서버의 IP 주소를 찾는 데 사용
- 하나의 도메인에 여러 A 레코드 설정 가능 (로드 밸런싱)

### 구조
```
[도메인 이름]  [TTL]  IN  A  [IPv4 주소]
```

### 예시

| 도메인 | TTL | 타입 | 값 | 설명 |
|--------|-----|------|-----|------|
| example.com | 3600 | A | 93.184.216.34 | 메인 도메인의 IP |
| www.example.com | 3600 | A | 93.184.216.34 | www 서브도메인의 IP |
| blog.example.com | 1800 | A | 198.51.100.10 | 블로그 서버의 IP |
| api.example.com | 600 | A | 203.0.113.50 | API 서버의 IP |

### 실제 설정 예시
```
example.com.           3600  IN  A  93.184.216.34
www.example.com.       3600  IN  A  93.184.216.34
blog.example.com.      1800  IN  A  198.51.100.10

# 로드 밸런싱을 위한 다중 A 레코드
example.com.           3600  IN  A  93.184.216.34
example.com.           3600  IN  A  93.184.216.35
example.com.           3600  IN  A  93.184.216.36
```

### 주요 특징
- 루트 도메인과 서브도메인 모두에 사용 가능
- 여러 IP 주소 설정 시 라운드 로빈 방식으로 분산
- 다른 레코드(MX, TXT 등)와 함께 사용 가능
- TTL을 짧게 설정하면 빠른 장애 조치 가능

---

## CNAME 레코드 (Canonical Name Record)

### 설명
- 도메인의 별칭(alias)을 만드는 레코드
- 한 도메인을 다른 도메인으로 포인팅
- CDN, 클라우드 서비스 연동에 자주 사용

### 구조
```
[별칭 도메인]  [TTL]  IN  CNAME  [실제 도메인]
```

### 예시

| 도메인 | TTL | 타입 | 값 | 설명 |
|--------|-----|------|-----|------|
| www.example.com | 3600 | CNAME | example.com | www를 메인 도메인으로 리다이렉트 |
| shop.example.com | 1800 | CNAME | shopify.example.com | 쇼핑몰을 Shopify로 연결 |
| cdn.example.com | 7200 | CNAME | d111111abcdef8.cloudfront.net | CDN 서비스 연결 |
| mail.example.com | 3600 | CNAME | ghs.google.com | Google Workspace 메일 |

### 실제 설정 예시
```
www.example.com.       3600  IN  CNAME  example.com.
blog.example.com.      3600  IN  CNAME  myblog.wordpress.com.
shop.example.com.      1800  IN  CNAME  shops.myshopify.com.
docs.example.com.      3600  IN  CNAME  cname.vercel-dns.com.
```

### CNAME 체인 예시
```
www.example.com.       CNAME  →  example.com.
example.com.           A      →  93.184.216.34

최종 결과: www.example.com → 93.184.216.34
```

### 주요 특징 및 제약사항
- **루트 도메인에는 사용 불가** (예: example.com은 CNAME 불가)
- 서브도메인에만 사용 (예: www.example.com, blog.example.com)
- 같은 이름으로 다른 레코드와 공존 불가
- CNAME이 있으면 해당 이름에 A, MX, TXT 등 다른 레코드 설정 불가
- CNAME 체인 길이를 짧게 유지 (성능 이슈)

### CNAME vs A 레코드

| 상황 | 권장 레코드 | 이유 |
|------|------------|------|
| IP가 자주 변경되는 서비스 | CNAME | IP 변경 시 자동 반영 |
| 고정 IP 서버 | A | 더 빠른 조회 속도 |
| 루트 도메인 | A | CNAME 사용 불가 |
| CDN 연동 | CNAME | CDN 제공자의 도메인 사용 |

---

## MX 레코드 (Mail Exchange Record)

### 설명
- 도메인의 이메일을 처리할 메일 서버를 지정
- 우선순위(priority) 값으로 여러 메일 서버의 순서 결정
- 낮은 우선순위 값이 더 높은 우선순위를 가짐

### 구조
```
[도메인]  [TTL]  IN  MX  [우선순위]  [메일서버 도메인]
```

### 예시

| 도메인 | TTL | 타입 | 우선순위 | 값 | 설명 |
|--------|-----|------|---------|-----|------|
| example.com | 3600 | MX | 10 | mail1.example.com | 주 메일 서버 |
| example.com | 3600 | MX | 20 | mail2.example.com | 백업 메일 서버 |
| example.com | 3600 | MX | 30 | mail3.example.com | 2차 백업 서버 |
| subdomain.example.com | 3600 | MX | 10 | mail.subdomain.example.com | 서브도메인 전용 메일 |

### 실제 설정 예시

#### Google Workspace 설정
```
example.com.  3600  IN  MX  1   aspmx.l.google.com.
example.com.  3600  IN  MX  5   alt1.aspmx.l.google.com.
example.com.  3600  IN  MX  5   alt2.aspmx.l.google.com.
example.com.  3600  IN  MX  10  alt3.aspmx.l.google.com.
example.com.  3600  IN  MX  10  alt4.aspmx.l.google.com.
```

#### Microsoft 365 설정
```
example.com.  3600  IN  MX  0   example-com.mail.protection.outlook.com.
```

#### 자체 메일 서버 설정
```
example.com.  3600  IN  MX  10  mail.example.com.
example.com.  3600  IN  MX  20  backup-mail.example.com.

# 메일 서버의 실제 IP 주소도 필요
mail.example.com.         3600  IN  A   203.0.113.10
backup-mail.example.com.  3600  IN  A   203.0.113.11
```

### 우선순위 작동 방식

| 우선순위 | 메일 서버 | 동작 |
|---------|----------|------|
| 10 | mail1.example.com | 먼저 시도 (가장 높은 우선순위) |
| 20 | mail2.example.com | mail1 실패 시 시도 |
| 30 | mail3.example.com | mail1, mail2 실패 시 시도 |

### 주요 특징
- 우선순위 값이 낮을수록 먼저 사용
- 같은 우선순위 값이면 무작위로 선택 (로드 밸런싱)
- MX 레코드가 가리키는 도메인은 반드시 A 레코드 필요
- MX 레코드는 CNAME을 가리킬 수 없음

### 이메일 수신 흐름
```
발신자 → user@example.com 전송
      ↓
DNS에서 example.com의 MX 레코드 조회
      ↓
우선순위 10: mail1.example.com
      ↓
mail1.example.com의 A 레코드 조회
      ↓
IP: 203.0.113.10으로 메일 전송
```

---

## NS 레코드 (Name Server Record)

### 설명
- 도메인의 DNS 정보를 관리하는 네임서버를 지정
- 도메인의 권한(authority)을 특정 네임서버에 위임
- 최소 2개 이상의 NS 레코드 설정 권장 (이중화)

### 구조
```
[도메인]  [TTL]  IN  NS  [네임서버 도메인]
```

### 예시

| 도메인 | TTL | 타입 | 값 | 설명 |
|--------|-----|------|-----|------|
| example.com | 86400 | NS | ns1.example.com | 주 네임서버 |
| example.com | 86400 | NS | ns2.example.com | 백업 네임서버 |
| example.com | 86400 | NS | ns3.example.com | 2차 백업 네임서버 |
| subdomain.example.com | 3600 | NS | ns1.subdomain.example.com | 서브도메인 위임 |

### 실제 설정 예시

#### 도메인 등록업체 네임서버
```
example.com.  86400  IN  NS  ns1.registrar.com.
example.com.  86400  IN  NS  ns2.registrar.com.
example.com.  86400  IN  NS  ns3.registrar.com.
```

#### 클라우드 DNS 서비스 (Cloudflare)
```
example.com.  86400  IN  NS  ava.ns.cloudflare.com.
example.com.  86400  IN  NS  sid.ns.cloudflare.com.
```

#### AWS Route 53
```
example.com.  172800  IN  NS  ns-123.awsdns-12.com.
example.com.  172800  IN  NS  ns-456.awsdns-45.net.
example.com.  172800  IN  NS  ns-789.awsdns-78.org.
example.com.  172800  IN  NS  ns-012.awsdns-01.co.uk.
```

#### 서브도메인 위임
```
# 메인 도메인의 NS 레코드
example.com.            86400  IN  NS  ns1.example.com.
example.com.            86400  IN  NS  ns2.example.com.

# 서브도메인을 다른 네임서버로 위임
dev.example.com.        3600   IN  NS  ns1.dev-hosting.com.
dev.example.com.        3600   IN  NS  ns2.dev-hosting.com.

# 이제 dev.example.com의 모든 레코드는 dev-hosting.com의 네임서버에서 관리
```

### 네임서버 계층 구조

```
루트 네임서버 (.)
    ↓
TLD 네임서버 (.com)
    ↓
권한 있는 네임서버 (example.com)
    ↓
서브도메인 네임서버 (dev.example.com)
```

### DNS 조회 과정 예시
```
사용자: www.example.com의 IP 주소는?
    ↓
1. 루트 네임서버 조회: .com의 네임서버 정보 획득
    ↓
2. .com 네임서버 조회: example.com의 NS 레코드 획득
    ↓
3. example.com의 네임서버에 질의: www.example.com의 A 레코드 획득
    ↓
4. 최종 IP 주소 반환
```

### 주요 특징
- 도메인당 최소 2개 이상의 NS 레코드 필요 (가용성)
- NS 레코드의 TTL은 보통 길게 설정 (24~48시간)
- 네임서버 변경 시 전파에 시간 소요
- 레지스트라와 DNS 제공자의 NS 레코드가 일치해야 함

### NS 레코드와 글루 레코드 (Glue Record)

네임서버가 같은 도메인 내에 있을 때 필요:

```
# NS 레코드
example.com.  86400  IN  NS  ns1.example.com.
example.com.  86400  IN  NS  ns2.example.com.

# 글루 레코드 (순환 참조 방지)
ns1.example.com.  86400  IN  A  203.0.113.1
ns2.example.com.  86400  IN  A  203.0.113.2
```

---

## 4가지 레코드의 상호작용 예시

### 완전한 도메인 설정
```
# NS 레코드 (네임서버 지정)
example.com.         86400  IN  NS  ns1.dnshost.com.
example.com.         86400  IN  NS  ns2.dnshost.com.

# A 레코드 (웹 서버)
example.com.         3600   IN  A   93.184.216.34
www.example.com.     3600   IN  A   93.184.216.34

# CNAME 레코드 (별칭)
blog.example.com.    3600   IN  CNAME  example.com.
shop.example.com.    3600   IN  CNAME  shopify.example.com.

# MX 레코드 (메일 서버)
example.com.         3600   IN  MX  10  mail.example.com.
example.com.         3600   IN  MX  20  backup-mail.example.com.

# 메일 서버의 A 레코드
mail.example.com.         3600  IN  A  203.0.113.10
backup-mail.example.com.  3600  IN  A  203.0.113.11
```

### 트래픽 흐름 시나리오

1. **웹사이트 방문**: www.example.com
   - NS 레코드로 권한 있는 네임서버 찾기
   - CNAME 레코드로 example.com 찾기
   - A 레코드로 IP 주소 획득
   - 93.184.216.34로 HTTP 요청

2. **이메일 전송**: user@example.com
   - NS 레코드로 권한 있는 네임서버 찾기
   - MX 레코드로 메일 서버 찾기
   - mail.example.com의 A 레코드로 IP 획득
   - 203.0.113.10으로 SMTP 연결

## 설정 시 주의사항

### A 레코드
- IP 주소 변경 전 TTL을 짧게 설정
- 중요한 서비스는 여러 IP로 이중화

### CNAME 레코드
- 루트 도메인에 절대 사용 금지
- MX, NS와 같은 이름으로 설정 불가
- 과도한 CNAME 체인 지양

### MX 레코드
- 메일 서버는 CNAME이 아닌 A 레코드 필요
- 최소 2개 이상의 MX 레코드 설정 권장
- 우선순위 값 중복 시 로드 밸런싱 효과

### NS 레코드
- 최소 2개 이상 필수 (가용성)
- 레지스트라와 DNS 존 파일 모두 일치 필요
- 변경 시 전파 시간 고려 (24-48시간)
